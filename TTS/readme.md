# TTS(음성합성) 청크 API 명세서 (최신)

# TTS(음성합성) 청크 API 명세서

## 1. 개요

- 긴 텍스트를 음성합성할 때, 첫 번째 청크는 500byte, 이후 청크는 3000byte 단위로 분할하여 처리합니다.
- 첫 번째 청크만 우선 음성 변환하여 반환하고, 이후 청크는 필요 시 별도 API로 요청하여 음성 변환합니다.
- 모든 청크는 동일한 voice 정보로 합성되어야 하므로, 첫 청크 응답의 voice 정보를 이후 요청에 반드시 사용해야 합니다.

---

## 2. API 상세

### 2-1. 첫 번째 청크 음성 요청

**POST** `/tts/synthesize_first_chunk`

### 요청 파라미터 (JSON)

| 이름 | 타입 | 필수 | 설명 |
| --- | --- | --- | --- |
| text | string | 예 | 전체 텍스트 |
| language_code | string | 예 | 언어 코드 (예: ko-KR) |

### 응답 예시

```json
{
  // 첫 번째 청크의 음성 데이터
  "audio_content": "BASE64_ENCODED_AUDIO",   

  // 전체 청크의 개수
  "chunk_count": 4,                          

  // 각 청크별 바이트 범위 정보
  "chunks": [    
    {"index": 0, "start": 0, "end": 499},     // 첫 번째 청크 (500바이트)
    {"index": 1, "start": 500, "end": 3499},  // 두 번째 청크 (3000바이트)
    {"index": 2, "start": 3500, "end": 6499}, // 세 번째 청크 (3000바이트)
    {"index": 3, "start": 6500, "end": 9999}  // 마지막 청크
  ],

  // 음성 합성에 사용된 보이스 정보
  "voice": {    
    "language_code": "ko-KR",
    "name": "ko-KR-Chirp3-HD-Charon"
  }
}
```

- **audio_content**: 첫 번째 청크의 음성(Base64 인코딩)
- **chunk_count**: 전체 청크 개수
- **chunks**: 각 청크의 인덱스, 시작/끝 바이트 정보
- **voice**: 실제 사용된 음성 정보(이후 요청에 반드시 사용)

---

### 2-2. 특정 청크 음성 요청

**POST** `/tts/synthesize_chunk`

### 요청 파라미터 (JSON)

| 이름 | 타입 | 필수 | 설명 |
| --- | --- | --- | --- |
| text | string | 예 | 전체 텍스트 |
| language_code | string | 예 | 언어 코드 |
| chunk_index | int | 예 | 요청할 청크 인덱스 (0부터) |
| name | string | 예 | 첫 청크에서 받은 voice.name |

### 응답 예시

```json
{  "audio_content": "BASE64_ENCODED_AUDIO", // 해당 청크의 음성  "index": 1}
```

---

## 3. 동작 흐름

1. **첫 음성 미리 로딩 시**  

   `/tts/synthesize_first_chunk` 호출 →  첫 청크 음성, 전체 청크 정보, voice 정보 수신

2. **첫 음성 끝까지 재생한 경우**

- 1번 응답에서 받은 voice 정보를 사용하여 `/tts/synthesize_chunk`를 각 청크 인덱스별로 비동기 호출
- 1번 음성의 인덱스가 0이니까 1번 재생 → 다 재생했으면 2번 또 호출해서 재생 → 반복

3. **재생 중단 시**

- 이게 좀 문제인데… 일단 인덱스 별로 받은 음성 모두 갖고 있어야할 것 같아요. 다시 재생하면 처음부터 재생하고 이어서 플레이.
- 텍스트가 변경되면 기존의 음성파일들은 초기화

---

## 4. 주의사항

- 반드시 첫 청크 응답의 `voice.name`을 이후 모든 청크 요청에 사용해야

  음성의 일관성이 유지됩니다.

- 텍스트는 항상 전체 텍스트를 보내야 하며,

  서버에서 동일한 방식으로 청크를 분할합니다.

- 첫 번째 청크는 500byte, 이후 청크는 3000byte 단위로 분할됩니다.

---

궁금한 점이나 추가 설명이 필요하면 언제든 문의해 주세요!